<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FEDUS | Exclusive Dashboard</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root {
  --fedus-orange:#f39c12;
  --light-blue:#eaf2f8;
  --accent-blue:#3498db;
  --text-dark:#2c3e50;
  --card-shadow:0 4px 15px rgba(0,0,0,0.08);
  --header-gradient:linear-gradient(90deg,#f39c12 0%,#e67e22 100%);
}
body{font-family:'Segoe UI',Tahoma,Verdana,sans-serif;background:var(--light-blue);margin:0;color:var(--text-dark)}
.header{background:var(--header-gradient);padding:15px 40px;display:flex;justify-content:space-between;align-items:center}
.header img{height:50px}
.header .title-text{color:#fff;font-weight:bold;font-size:24px}
.container{padding:25px}
.toolbar{display:flex;gap:20px;margin-bottom:25px;background:#fff;padding:25px;border-radius:12px;box-shadow:var(--card-shadow)}
.input-group{display:flex;flex-direction:column;gap:8px;flex:1}
input{padding:14px;border-radius:8px;border:1px solid #ddd}
.action-btn{height:48px;padding:0 25px;border:none;border-radius:8px;color:#fff;font-weight:bold;cursor:pointer}
.refresh-btn{background:var(--accent-blue)}
.reset-btn{background:#95a5a6}
.metrics-grid{display:grid;grid-template-columns:320px 1fr 1fr;gap:25px;margin-bottom:25px}
.metric-card,.analysis-card{background:#fff;padding:25px;border-radius:15px;box-shadow:var(--card-shadow)}
.metric-card{border-top:6px solid var(--fedus-orange);text-align:center}
.metric-card h2{font-size:56px;color:var(--accent-blue);margin:0}
.analysis-card{border-top:6px solid var(--accent-blue)}
.table-wrap{background:#fff;border-radius:15px;box-shadow:var(--card-shadow)}
.table-scroll{overflow-x:auto;max-height:750px}
table{width:100%;border-collapse:collapse;font-size:12.8px}
th{position:sticky;top:0;background:#fff;border-bottom:4px solid var(--fedus-orange);padding:18px 10px}
td{padding:16px 10px;border-bottom:1px solid #f0f0f0;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}
tr:nth-child(even){background:#fafbfc}
.w-date{width:95px}.w-prod{width:160px}.w-name{width:140px}.w-email{width:180px}
.w-mobile{width:110px}.w-order{width:150px}.w-source{width:110px}
.w-plat{width:95px}.w-state{width:115px}.w-pin{width:75px}
#loadingOverlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,.85);z-index:9999;align-items:center;justify-content:center;flex-direction:column}
.spinner{width:50px;height:50px;border:5px solid #eee;border-top:5px solid var(--fedus-orange);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div id="loadingOverlay">
  <div class="spinner"></div>
  <b>SYNCHRONIZING…</b>
</div>

<div class="header">
  <img src="https://raw.githubusercontent.com/sachinfedus-lang/2026-data/main/logo.png">
  <div class="title-text">EXCLUSIVE DASHBOARD</div>
</div>

<div class="container">

<div class="toolbar">
  <div class="input-group">
    <label>Search Database</label>
    <input id="searchInput" onkeyup="processData()" placeholder="Search…">
  </div>
  <div class="input-group">
    <label>Date Range</label>
    <input id="datePicker">
  </div>
  <button class="action-btn refresh-btn" onclick="loadData()">REFRESH</button>
  <button class="action-btn reset-btn" onclick="clearFilters()">RESET</button>
</div>

<div class="metrics-grid">
  <div class="metric-card">
    <h2 id="totalEntries">0</h2>
    <p>TOTAL ENTRIES</p>
  </div>
  <div class="analysis-card">
    <h3>Orders by Platform</h3>
    <div id="platformStats"></div>
  </div>
  <div class="analysis-card">
    <h3>Top 5 Regional Distribution</h3>
    <div id="regionList"></div>
  </div>
</div>

<div class="table-wrap">
<div class="table-scroll">
<table>
<thead>
<tr>
<th class="w-date">Date</th>
<th class="w-prod">Product</th>
<th class="w-name">Customer</th>
<th class="w-email">Email</th>
<th class="w-mobile">Mobile</th>
<th class="w-order">Order ID</th>
<th class="w-source">Source</th>
<th class="w-plat">Platform</th>
<th class="w-state">State</th>
<th class="w-pin">Pin</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>
</div>

</div>

<script>
const csvUrl='https://docs.google.com/spreadsheets/d/e/2PACX-1vTo_H6uUDOXjAILtefs-VU0oG-OxyLGMkxxBTgvkVjL-xtkOXKDpzewRtLQxTYg-2HfNoO6C3TuQa-H/pub?gid=1747140024&single=true&output=csv';
let rawData=[];

const fp=flatpickr("#datePicker",{mode:"range",dateFormat:"d/m/Y",onClose:processData});

function parseCSV(t){
 let r=[],row=[''],i=0,q=false;
 for(let c of t){
  if(c=='"')q=!q;
  else if(c==','&&!q){row.push('');i++}
  else if(c=='\n'&&!q){r.push(row);row=[''];i=0}
  else row[i]+=c;
 }
 if(row.length>1)r.push(row);
 return r;
}

async function loadData(){
 document.getElementById('loadingOverlay').style.display='flex';
 const res=await fetch(csvUrl+'&cb='+Date.now());
 const rows=parseCSV(await res.text());

 rawData=rows.slice(1).map(c=>({
   dtStr:(c[3]||'').trim(),                     // Purchase Date
   dtObj:new Date((c[3]||'').split('/').reverse().join('-')),
   nm:(c[5]||'').trim().toLowerCase().replace(/\b\w/g,l=>l.toUpperCase()),
   em:(c[8]||'').trim().toLowerCase(),
   ph:(c[6]||'').trim(),
   id:(c[4]||'').trim(),
   src:(c[11]||'').trim(),                      // Source
   pl:(c[9]||'').trim(),                        // Platform
   st:(c[12]||'').trim(),                       // State
   pn:(c[13]||'').trim(),                       // Pin
   pName:(c[15]||'').trim(),                    // Product Name
   blob:c.join(' ').toLowerCase()
 })).filter(r=>r.nm && r.nm!=="Full Name");

 processData();
 document.getElementById('loadingOverlay').style.display='none';
}

function processData(){
 let d=[...rawData];
 const s=document.getElementById('searchInput').value.toLowerCase();
 if(s)d=d.filter(r=>r.blob.includes(s));
 if(fp.selectedDates.length==2){
  let a=fp.selectedDates[0],b=fp.selectedDates[1];
  d=d.filter(r=>r.dtObj>=a&&r.dtObj<=b);
 }
 d.sort((a,b)=>a.dtObj-b.dtObj);
 render(d);
}

function render(d){
 document.getElementById('totalEntries').innerText=d.length;
 document.getElementById('tableBody').innerHTML=d.map(r=>`
<tr>
<td>${r.dtStr}</td>
<td title="${r.pName}">${r.pName}</td>
<td><b>${r.nm}</b></td>
<td>${r.em}</td>
<td>${r.ph}</td>
<td><b>${r.id}</b></td>
<td>${r.src}</td>
<td>${r.pl}</td>
<td>${r.st}</td>
<td>${r.pn}</td>
</tr>`).join('');

 let reg={},plat={};
 d.forEach(r=>{if(r.st)reg[r.st]=(reg[r.st]||0)+1;if(r.pl)plat[r.pl]=(plat[r.pl]||0)+1});
 document.getElementById('platformStats').innerHTML=Object.entries(plat).map(p=>`<div>${p[0]}: ${p[1]}</div>`).join('');
 document.getElementById('regionList').innerHTML=Object.entries(reg).slice(0,5).map(r=>`<div>${r[0]}: ${r[1]}</div>`).join('');
}

function clearFilters(){document.getElementById('searchInput').value='';fp.clear();processData()}
window.onload=loadData;
</script>

</body>
</html>

