<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FEDUS | 2026 Operations Dashboard</title>
    <style>
        :root { --fedus-blue: #0a111f; --fedus-green: #27ae60; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; }
        
        /* HEADER STYLING */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: var(--fedus-blue); padding: 10px 30px; border-radius: 12px; color: white; }
        .logo-area { display: flex; align-items: center; gap: 12px; } /* Gap between logo and text */
        .logo-img { height: 45px; width: auto; border-radius: 4px; }
        
        .refresh-btn { background: var(--fedus-green); color: white; border: none; padding: 8px 18px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .sync-pill { background: rgba(39, 174, 96, 0.1); color: #2ecc71; padding: 6px 14px; border-radius: 20px; font-size: 11px; border: 1px solid var(--fedus-green); font-weight: 600; }
        
        .kpi-row { text-align: center; margin-bottom: 25px; }
        .lifetime-card { background: linear-gradient(135deg, #1c2d41 0%, #0a111f 100%); padding: 20px; border-radius: 12px; color: white; display: inline-block; min-width: 250px; }
        
        .search-box { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 15px; box-sizing: border-box; }
        
        .table-wrap { background: white; border-radius: 12px; border: 1px solid #ddd; overflow: hidden; }
        .table-scroll { overflow-y: auto; overflow-x: auto; max-height: 600px; position: relative; }
        
        table { width: 100%; border-collapse: collapse; font-size: 12px; table-layout: fixed; }
        
        th { 
            background: #f8f9fa; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
            padding: 12px; 
            text-align: left; 
            border-bottom: 2px solid #eee;
            box-shadow: 0 1px 0 rgba(0,0,0,0.1);
        }
        
        td { padding: 10px 12px; border-bottom: 1px solid #f1f1f1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: help; }
        tr:hover { background-color: #f9fbfc; }

        .col-dt { width: 90px; } .col-nm { width: 140px; } .col-ph { width: 100px; }
        .col-ap { width: 100px; } .col-em { width: 160px; } .col-pl { width: 90px; }
        .col-id { width: 140px; } .col-sc { width: 90px; } .col-st { width: 100px; }
        .col-pn { width: 70px; } .col-pr { width: 150px; } .col-pc { width: 100px; }
        .col-pf { width: 100px; }

        .invoice-link { color: #3498db; text-decoration: none; font-weight: bold; }
        .invoice-link:hover { text-decoration: underline; }
    </style>
</head>
<body>

<div class="header">
    <div class="logo-area">
        <img src="https://raw.githubusercontent.com/sachinfedus-lang/2026-data/main/logo.png" alt="Logo" class="logo-img">
        <h2 style="margin:0; font-weight: 500; letter-spacing: 1px;">Dashboard</h2>
    </div>
    <div class="header-actions">
        <span id="syncStatus" class="sync-pill">CONNECTING...</span>
        <button class="refresh-btn" onclick="fetchData()">ðŸ”„ REFRESH</button>
    </div>
</div>

<div class="kpi-row">
    <div class="lifetime-card">
        <h2 id="totalCount" style="margin:0; font-size:36px;">0</h2>
        <p style="margin:0; text-transform:uppercase; font-size:11px;">Total Orders</p>
    </div>
</div>

<input type="text" id="searchInput" class="search-box" placeholder="ðŸ” Search any field..." onkeyup="filterData()">

<div class="table-wrap">
    <div class="table-scroll">
        <table>
            <thead>
                <tr>
                    <th class="col-dt">Date</th><th class="col-nm">Name</th><th class="col-ph">Phone</th>
                    <th class="col-ap">Alt Phone</th><th class="col-em">Email</th><th class="col-pl">Platform</th>
                    <th class="col-id">Order ID</th><th class="col-sc">Source</th><th class="col-st">State</th>
                    <th class="col-pn">Pin</th><th class="col-pr">Product</th><th class="col-pc">Code</th>
                    <th class="col-pf">Invoice</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script>
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTo_H6uUDOXjAILtefs-VU0oG-OxyLGMkxxBTgvkVjL-xtkOXKDpzewRtLQxTYg-2HfNoO6C3TuQa-H/pub?gid=0&single=true&output=csv';
    let masterData = [];

    async function fetchData() {
        try {
            const response = await fetch(csvUrl + '&cb=' + Date.now());
            const text = await response.text();
            masterData = parseCSV(text);
            updateDashboard(masterData);
            document.getElementById('syncStatus').innerText = "LIVE: " + new Date().toLocaleTimeString();
        } catch (e) { document.getElementById('syncStatus').innerText = "OFFLINE"; }
    }

    function parseCSV(text) {
        const rows = [];
        let cur = [], val = '', q = false;
        for (let i = 0; i < text.length; i++) {
            let c = text[i], n = text[i+1];
            if (c === '"') { if (q && n === '"') { val += '"'; i++; } else q = !q; }
            else if (c === ',' && !q) { cur.push(val); val = ''; }
            else if ((c === '\r' || c === '\n') && !q) {
                cur.push(val); if (cur.length > 1) rows.push(cur);
                cur = []; val = ''; if (c === '\r' && n === '\n') i++;
            } else val += c;
        }
        if (val || cur.length > 0) { cur.push(val); rows.push(cur); }
        
        return rows.slice(1).map(c => ({
            dt: (c[0]||'').trim(), nm: (c[1]||'').trim(), ph: (c[2]||'').trim(),
            ap: (c[3]||'').trim(), em: (c[4]||'').trim(), pl: (c[5]||'').trim(),
            id: (c[6]||'').trim(), sc: (c[7]||'').trim(), st: (c[8]||'').trim(),
            pn: (c[9]||'').trim(), pr: (c[10]||'').trim(), pc: (c[11]||'').trim(),
            pf: (c[12]||'').trim() 
        })).filter(r => r.nm !== "");
    }

    function updateDashboard(data) {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = data.map(r => {
            const invoiceLink = r.pf.startsWith('http') ? `<a href="${r.pf}" target="_blank" class="invoice-link">View File</a>` : 'No File';
            return `
            <tr>
                <td class="col-dt" title="${r.dt}">${r.dt}</td>
                <td class="col-nm" title="${r.nm}"><strong>${r.nm}</strong></td>
                <td class="col-ph" title="${r.ph}">${r.ph}</td>
                <td class="col-ap" title="${r.ap}">${r.ap}</td>
                <td class="col-em" title="${r.em}">${r.em}</td>
                <td class="col-pl" title="${r.pl}">${r.pl}</td>
                <td class="col-id" title="${r.id}" style="color:#2980b9; font-weight:bold;">${r.id}</td>
                <td class="col-sc" title="${r.sc}">${r.sc}</td>
                <td class="col-st" title="${r.st}">${r.st}</td>
                <td class="col-pn" title="${r.pn}">${r.pn}</td>
                <td class="col-pr" title="${r.pr}">${r.pr}</td>
                <td class="col-pc" title="${r.pc}">${r.pc}</td>
                <td class="col-pf" title="${r.pf}">${invoiceLink}</td>
            </tr>
        `}).join('');
        document.getElementById('totalCount').innerText = data.length;
    }

    function filterData() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const filtered = masterData.filter(row => 
            Object.values(row).some(val => val.toLowerCase().includes(query))
        );
        updateDashboard(filtered);
    }

    window.onload = fetchData;
    setInterval(fetchData, 60000); 
</script>
</body>
</html>
